#include <stdio.h>
#include <stdlib.h>
#define NB_DEVISES 12
int valeurs[NB_DEVISES]= {5000, 2000, 1000, 500, 200, 100, 50, 20, 10, 5, 2 ,1};
char types[NB_DEVISES]= {'B', 'B', 'B', 'B', 'P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'};

int lireEntier() {
	int entierLu;
	int nbEntiersLus;
	char videTampon;

	do {
		nbEntiersLus = scanf("%d", &entierLu);
		if (nbEntiersLus != 1) {
			printf("Erreur de format : veuillez saisir un entier.\n");

		}
		// vidage du reste du tampon (si plusieurs entiers ou saisie invalide)
		do {
			scanf("%c", &videTampon);
		} while (videTampon != '\n');
	} while (nbEntiersLus != 1);

	return(entierLu);
}

int rendre(int prix, int montantClient)
{
    int aRendre, compteur, aRendreDepart;
    int caisse[NB_DEVISES]={0};

    aRendre = montantClient - prix;
    aRendreDepart = aRendre;
    do
    {
        if (aRendre >= 5000)
        {
            caisse[0]++;
            aRendre = aRendre -5000;
        }
        else if (aRendre >= 2000)
        {
            caisse[1]++;
            aRendre = aRendre -2000;
        }
        else if (aRendre >= 1000)
        {
            caisse[2]++;
            aRendre = aRendre -1000;
        }
        else if (aRendre >= 500)
        {
            caisse[3]++;
            aRendre = aRendre -500;
        }
        else if (aRendre >= 200)
        {
            caisse[4]++;
            aRendre = aRendre -200;
        }
        else if (aRendre >= 100)
        {
            caisse[5]++;
            aRendre = aRendre -100;
        }
        else if (aRendre >= 50)
        {
            caisse[6]++;
            aRendre = aRendre -50;
        }
        else if (aRendre >= 20)
        {
            caisse[7]++;
            aRendre = aRendre -20;
        }
        else if (aRendre >= 10)
        {
            caisse[8]++;
            aRendre = aRendre -10;
        }
        else if (aRendre >= 5)
        {
            caisse[9]++;
            aRendre = aRendre -5;
        }
        else if (aRendre >=2)
        {
            caisse[10]++;
            aRendre = aRendre -2;
        }
        else if (aRendre >= 1)
        {
            caisse[11]++;
            aRendre = aRendre -1;
        }

    } while (aRendre != 0);

    printf("%d,%d euros ont été versés pour %d,%d euros dûs. La monnaie à rendre (%d,%d euro) est composés de :\n", montantClient/100, montantClient%100, prix/100, prix%100, aRendreDepart/100, aRendreDepart%100);
    for (compteur=0; compteur<12; compteur++)
    {
        if (caisse[compteur] !=0)
        {
            printf("%d %c de %d,%2d euros\n", caisse[compteur], types[compteur], valeurs[compteur]/100, valeurs[compteur]%100);
        }
    }
}


int main()
{
    int prix; int montantClient; int retry=2;
    do
    {
        printf("\n## APPLICATION CAISSE ##\n Saisissez le montant de la vente :\n");
        prix = lireEntier();
        printf("\n Saisissez le montant donné par le client :\n");
        montantClient = lireEntier();
        while (montantClient < prix)
        {
            printf("/!\ Erreur : ce client n'a pas versé assez d'argent : il manque %d.\n", prix-montantClient);
            montantClient = lireEntier();
        }
        rendre(prix, montantClient);
        retry=2;
        while (retry != 1 && retry !=0)
        {
            printf("\nSouhaitez-vous refaire une autre transaction ?  0 pour quitter, 1 pour continuer ...\n");
            retry=lireEntier();
        }

    } while (retry != 0);

    return 0;
}
